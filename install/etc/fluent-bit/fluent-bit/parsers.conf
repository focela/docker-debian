#-----------------------------------------------------------------------------
# Fluent-bit Log Parsers Configuration
#
# Purpose: Define custom log parser configurations for fluent-bit
# Context: Loaded by fluent-bit service during container initialization
# Note: These parsers handle various log formats including custom application
#       logs, syslog standards, and JSON structured logging
#-----------------------------------------------------------------------------



#-----------------------------------------------------------------------------
# CUSTOM APPLICATION LOG PARSER
#-----------------------------------------------------------------------------
# Parser for custom application logs with timestamp, severity, and category
[PARSER]
  Name        fluentbit
  Format      regex
  Regex       ^\[(?<time>[^\]]*)\] \[(?<severity>[^\]]*)\] \[(?<category>[^\]]*)\] (?<message>.*)
  Time_Key    time
  Time_Format %Y/%m/%d %H:%M:%S


#-----------------------------------------------------------------------------
# JSON STRUCTURED LOGGING PARSER
#-----------------------------------------------------------------------------
# Parser for JSON formatted log entries
[PARSER]
  Name   json
  Format json
  # Time_Key time
  # Time_Format %d/%b/%Y:%H:%M:%S %z


#-----------------------------------------------------------------------------
# SYSLOG RFC5424 PARSER
#-----------------------------------------------------------------------------
# Parser for syslog messages following RFC5424 standard
[PARSER]
  Name        syslog-rfc5424
  Format      regex
  Regex       ^\<(?<pri>[0-9]{1,5})\>1 (?<time>[^ ]+) (?<host>[^ ]+) (?<ident>[^ ]+) (?<pid>[-0-9]+) (?<msgid>[^ ]+) (?<extradata>(\[(.*?)\]|-)) (?<message>.+)$
  Time_Key    time
  Time_Format %Y-%m-%dT%H:%M:%S.%L%z
  Time_Keep   On


#-----------------------------------------------------------------------------
# SYSLOG RFC3164 LOCAL PARSER
#-----------------------------------------------------------------------------
# Parser for local syslog messages following RFC3164 standard
[PARSER]
  Name        syslog-rfc3164-local
  Format      regex
  Regex       ^\<(?<pri>[0-9]+)\>(?<time>[^ ]* {1,2}[^ ]* [^ ]*) (?<ident>[a-zA-Z0-9_\/\.\-]*)(?:\[(?<pid>[0-9]+)\])?(?:[^\:]*\:)? *(?<message>.*)$
  Time_Key    time
  Time_Format %b %d %H:%M:%S
  Time_Keep   On


#-----------------------------------------------------------------------------
# SYSLOG RFC3164 REMOTE PARSER
#-----------------------------------------------------------------------------
# Parser for remote syslog messages following RFC3164 standard
[PARSER]
  Name        syslog-rfc3164
  Format      regex
  Regex       /^\<(?<pri>[0-9]+)\>(?<time>[^ ]* {1,2}[^ ]* [^ ]*) (?<host>[^ ]*) (?<ident>[a-zA-Z0-9_\/\.\-]*)(?:\[(?<pid>[0-9]+)\])?(?:[^\:]*\:)? *(?<message>.*)$/
  Time_Key    time
  Time_Format %b %d %H:%M:%S
  Time_Keep   On


#-----------------------------------------------------------------------------
# ZABBIX AGENT CLASSIC PARSER
#-----------------------------------------------------------------------------
# Parser for Zabbix agent classic log format
[PARSER]
  Name        zabbix-agent-classic
  Format      regex
  Regex       ^  (?<pid>[-0-9]+):(?<time>[^ ]+) *(?<message>.*)
  Time_Key    time
  # Time_Format %Y%m%d:%H%M.%s


#-----------------------------------------------------------------------------
# ZABBIX AGENT MODERN PARSER
#-----------------------------------------------------------------------------
# Parser for Zabbix agent modern log format
[PARSER]
  Name        zabbix-agent-modern
  Format      regex
  Regex       ^(?<time>[^ ]* {1}[^ ]*[^ ]*) *(?<message>.*)$
  Time_Key    time
  # Time_Format %Y/%m/%d %H:%M:%s
